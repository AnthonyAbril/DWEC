<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>      

      th {
        width: 20px;
        height: 20px;
        text-align: center;
        border: 1px solid black;
      }

      /* Limita el ancho y el alto de la tabla */
      #tablero {
        max-width: 100vw;
        max-height: 100vw;
        overflow: auto; /* Permite desplazarse en caso de ser necesario */
      }

      /* Asegura que las celdas sean cuadradas incluso si se ajusta el tamaño de la tabla */
      #tablero table {
        /*table-layout: fixed;*/
        width: max-content; /* Asegura que las celdas no se expandan automáticamente */
      }

      p{
        display: inline-block;
      }
      
    </style>
  </head>
  <body>
    <div id="barraSuperior">
      <p id="tiempo">Tiempo: </p>
      <p id="minas">Minas: </p>
      <p id="nivel">Nivel: </p>
    </div>
    <div id="tablero"></div>
  </body>
  <script>
    nivel = 0;

    switch (nivel) {
      case 0: //Sencillo -> entre 10 y 20 columnas y filas de manera aleatoria. 25 minas.
        minas = 25;
        alto = Math.floor(Math.random() * 11) + 10;
        ancho = Math.floor(Math.random() * 11) + 10;
        break;
      case 1: //Normal -> entre 20 y 40 columnas y filas de manera aleatoria. 60 minas.
        minas = 60;
        alto = Math.floor(Math.random() * 21) + 20;
        ancho = Math.floor(Math.random() * 21) + 20;
        break;

      case 2: //Avanzado -> entre 40 y 80 columnas y filas de manera aleatoria. 100 minas
        minas = 100;
        alto = Math.floor(Math.random() * 41) + 40;
        ancho = Math.floor(Math.random() * 41) + 40;
        break;

      case 3: //Experto -> entre 80 y 100 columnas y filas de manera aleatoria. 140 minas.
        minas = 140;
        alto = Math.floor(Math.random() * 21) + 80;
        ancho = Math.floor(Math.random() * 21) + 80;
        break;

      default:
        break;
    }
    encontradas = 0;

    function generarNumerosAleatoriosUnicos(cantidad, maxNumero) {
      let numerosAleatorios = new Set(); // Creamos un set

      // Agregar números aleatorios únicos hasta alcanzar la cantidad deseada
      while (numerosAleatorios.size < cantidad) {
        let numeroAleatorio = Math.floor(Math.random() * maxNumero);
        numerosAleatorios.add(numeroAleatorio); // El set evita duplicados automáticamente
      }

      // Convertir el set a un array y devolverlo
      return Array.from(numerosAleatorios);
    }

    mapaDeMinas = generarNumerosAleatoriosUnicos(minas, alto * ancho); //Las posiciones de las minas
    perdido = false;

    function perder(){
      alert("Has perdido");
      perdido = true;
      for (element of document.getElementsByClassName("mina")) {
        element.style["background-color"] = "red";
      }
    }

    function crearCasilla(posicion) {
      casilla = document.createElement("th");
      casilla.style["background-color"] = "grey";
      casilla.setAttribute("id", posicion);
      if (mapaDeMinas.includes(posicion)) {
        casilla.setAttribute("class", "mina");
        casilla.appendChild(document.createTextNode("m"));
        casilla.addEventListener("click", function () {
          perder();
        });
      } else {
        casilla.appendChild(document.createTextNode(minasCerca(posicion)));
        casilla.addEventListener("click", function () {
          descubrirAlrededores(posicion);
        });
      }
      return casilla;
    }

    function descubrirAlrededores(posicion) {
      let casillaActual = document.getElementById(posicion);

      //si ya esta descubierta no se descubre
      if (casillaActual.style["background-color"] === "white") {
        return; // Evita descubrir casillas ya descubiertas
      }

      //se descubre la casilla
      casillaActual.style["background-color"] = "white";

      if(casillaActual.textContent === "0"){//si la casilla actual es 0 descubren las de alrededor
        //guardamos las casillas que rodean la actual
        let alrededores = [
          posicion - 1,
          posicion + 1,
          posicion - ancho,
          posicion + ancho,
          posicion - ancho - 1,
          posicion - ancho + 1,
          posicion + ancho - 1,
          posicion + ancho + 1,
        ];

        for (const element of alrededores) {
          let casillaVecina = document.getElementById(element);

          if (
            casillaVecina &&
            !casillaVecina.classList.contains("mina") &&
            casillaVecina.style["background-color"] !== "white"
          ) {
            descubrirAlrededores(element);
          }
        }
      }else{//se descubre solo la casilla actual
        
      }
      
    }

    function minasCerca(posicion) {
      alrededores = [
        posicion - 1,
        posicion + 1,
        posicion - ancho,
        posicion - ancho + 1,
        posicion - ancho - 1,
        posicion + ancho,
        posicion + ancho + 1,
        posicion + ancho - 1,
      ];

      cerca = 0;
      for (const element of alrededores) {
        if (mapaDeMinas.includes(element)) cerca++;
      }
      return cerca;
    }

    function crearTablero() {
      tabla = document.createElement("table");
      for (let f = 0; f < alto; f++) {
        fila = document.createElement("tr");
        for (let c = 0; c < ancho; c++) {
          casilla = crearCasilla(c + f * ancho);
          
          fila.appendChild(casilla);
        }
        tabla.appendChild(fila);
      }
      document.getElementById("tablero").appendChild(tabla);
    }

    crearTablero();
  </script>
</html>
